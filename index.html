class State:
    """Simple class to represent the application state."""
    def __init__(self):
        self.score = 0
        self.current_element = "Hydrogen"
        self.logged_in = False


class Page:
    """A simple Page class that generates HTML."""
    def __init__(self, title: str, body: list[str]):
        self.title = title
        self.body = body

    def render(self):
        """Renders the page into a full HTML response."""
        return f"""
        <html>
            <head><title>{self.title}</title></head>
            <body>
                {"<br>".join(self.body)}
            </body>
        </html>
        """


# Simulated view decorator to return Page directly
def view(func):
    """Mock decorator to just call the given function for now."""
    def wrapper(state):
        page = func(state)
        return page.render()  # Render the page directly
    return wrapper


# The main view we're testing
state = State()  # Create an instance of the application state


@view
def index(state: State):
    """Index view to handle the root route."""
    return Page(
        title="Chemical Elements Quiz",
        body=[
            f"Welcome! Your score is {state.score}.",
            f"Current element: {state.current_element}",
            "Are you logged in? " + str(state.logged_in)
        ]
    )


class MyWebApp:
    """Mock web server with routing capabilities."""
    def __init__(self):
        self.routes = {}

    def route(self, path, handler):
        """Registers a route."""
        self.routes[path] = handler

    def run(self):
        """Runs a mock server."""
        from wsgiref.simple_server import make_server

        def application(environ, start_response):
            """Simple WSGI app handler."""
            path = environ.get("PATH_INFO", "/")
            handler = self.routes.get(path)
            if handler:
                response_body = handler(state).encode("utf-8")
                start_response("200 OK", [("Content-Type", "text/html"), ("Content-Length", str(len(response_body)))])
                return [response_body]
            else:
                start_response("404 Not Found", [("Content-Type", "text/html")])
                return [b"Page not found"]

        # Bind the application to a server on localhost
        server = make_server('localhost', 8000, application)
        print("Serving on http://localhost:8000...")
        server.serve_forever()


# Initialize app, register routes, and run the server
app = MyWebApp()
app.route("/", index)  # Bind index to the root URL

# Start the server
app.run()

